var _=(g,a,o)=>new Promise((r,i)=>{var d=s=>{try{c(o.next(s))}catch(p){i(p)}},m=s=>{try{c(o.throw(s))}catch(p){i(p)}},c=s=>s.done?r(s.value):Promise.resolve(s.value).then(d,m);c((o=o.apply(g,a)).next())});import{B,n as l,a2 as x,aU as n,J as E,q as H,aP as I,aV as L,G as T,z as M,b as Y,r as j,aO as z,a_ as J,aD as h}from"./index-BgaAjVjm.js";import{_ as N}from"./form.vue_vue_type_script_setup_true_lang-Cx_XzLLk.js";import{u as P}from"./viewsPublic-BlInyJTa.js";import{r as f,a as U}from"./role-DGTjRGUm.js";import{g as W}from"./menu-DM2e6oQq.js";import"./hooks-KDYNtrFv.js";import"./index-CTRvZZ69.js";import"./base-C5PwI6TN.js";function ae(g,a){const{t:o}=B(),r=l({}),i=l(!1),d=l(),m=l(!1),c=l(!1),s=l(!1),p=l(),y=l([]),v=l([]),S={value:"id",label:"title",children:"children"},{switchStyle:C}=P(),b=x({list:f.list,fields:f.fields,save:f.save,delete:f.delete}),D=x({list:!0,create:n("add"),update:n("edit"),delete:n("delete"),batchDelete:n("delete"),import:n("import"),export:n("export"),download:n("download"),auth:n("auth")}),k=[{label:"角色编号",prop:"id"},{label:"角色名称",prop:"name"},{label:"状态",prop:"status",minWidth:90,cellRenderer:e=>{var t;return Y(j("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(t=r.value[e.index])==null?void 0:t.loading,modelValue:e.row.status,"onUpdate:modelValue":u=>e.row.status=u,"active-value":1,"inactive-value":0,"active-text":"已启用","inactive-text":"已停用","inline-prompt":!0,style:C.value,onChange:()=>O(e)},null)}},{label:"备注",prop:"remark",minWidth:160},{label:"创建时间",prop:"create_time",minWidth:160,formatter:({create_time:e})=>z(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:210,slot:"operation"}],K=E({title:o("role.title"),form:N,props:{treeMenuData:e=>{var t;return{treeData:y.value,treeIds:v.value,treeSelected:(t=e==null?void 0:e.menu_ids)!=null?t:[]}}},row:{status:e=>{var t;return(t=e.status)!=null?t:1},menu_ids:e=>{var t;return(t=e.menu_ids)!=null?t:[]}},columns:()=>[{prop:"name",valueType:"input"},{prop:"code",valueType:"input"},{prop:"status",valueType:"radio",renderField:U()},{prop:"remark",valueType:"textarea"},{prop:"menu_ids",valueType:"input"}]});function O({row:e,index:t}){J.confirm(`确认要<strong>${e.status===0?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${e.name}</strong>吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{if(!n("edit"))return h("权限不足！",{type:"error"}),!1;b.save({id:e.id,status:e.status}).then(u=>{u.code==200?(r.value[t]=Object.assign({},r.value[t],{loading:!0}),setTimeout(()=>{r.value[t]=Object.assign({},r.value[t],{loading:!1}),h(`已${e.status===0?"停用":"启用"}${e.name}`,{type:"success"})},300)):h(u.error,{type:"error"})})}).catch(()=>{e.status===0?e.status=1:e.status=0})}function F(e){return _(this,null,function*(){const{id:t,menu_ids:u}=e;t?(d.value=e,i.value=!0,setTimeout(()=>{a.value.setCheckedKeys(JSON.parse(JSON.stringify(u)))},50)):(d.value=null,i.value=!1)})}function V(){const{id:e,name:t}=d.value;b.save({id:e,menu_ids:a.value.getCheckedKeys()}).then(u=>{h(`角色名称为${t}的菜单权限修改成功`,{type:"success"}),g.value.onSearch()})}const $=e=>{a.value.filter(e)},A=(e,t)=>M(t.title).includes(e);return H(()=>_(this,null,function*(){const{data:e}=yield W({page_type:0});v.value=I(e.list,"id"),y.value=L(e.list)})),T(m,e=>{e?a.value.setExpandedKeys(v.value):a.value.setExpandedKeys([])}),T(c,e=>{e?a.value.setCheckedKeys(v.value):a.value.setCheckedKeys([])}),{api:b,auth:D,columns:k,isShow:i,curRow:d,isExpandAll:m,isSelectAll:c,isLinkage:s,handleMenu:F,handleSave:V,treeSearchValue:p,onQueryChanged:$,treeData:y,treeProps:S,filterMethod:A,transformI18n:M,editForm:K}}export{ae as useRole};
