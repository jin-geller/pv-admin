var v=(i,h,n)=>new Promise((d,f)=>{var o=s=>{try{r(n.next(s))}catch(g){f(g)}},m=s=>{try{r(n.throw(s))}catch(g){f(g)}},r=s=>s.done?d(s.value):Promise.resolve(s.value).then(o,m);r((n=n.apply(i,h)).next())});import{a2 as $,n as a,q as X,aP as w,aV as ee,G as x,z as R,b as te,r as ae,aO as se,aZ as ne,a_ as le,aD as u,S as ie,aW as ue,R as re,aj as oe}from"./index-BA19eJmX.js";import{_ as ce}from"./form.vue_vue_type_script_setup_true_lang-Bxk0xpjM.js";import{u as de}from"./publicStyle-21uR1UcM.js";import{r as b,a as fe,g as me}from"./role-CicKRrAx.js";import{g as ge}from"./menu-O0iCQE_R.js";function Ce(i){const h=$({name:"",status:""}),n=a(),d=a(),f=a([]),o=a([]),m=a([]),r=a(!1),s=a(!0),g=a(),p=a({}),C=a(!1),D=a(!1),z=a(!1),{switchStyle:K}=de(),L={value:"id",label:"title",children:"children"},y=$({total:0,pageSize:10,currentPage:1,background:!0}),F=[{label:"角色编号",prop:"id"},{label:"角色名称",prop:"name"},{label:"状态",prop:"status",minWidth:90,cellRenderer:e=>{var t;return te(ae("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(t=p.value[e.index])==null?void 0:t.loading,modelValue:e.row.status,"onUpdate:modelValue":l=>e.row.status=l,"active-value":1,"inactive-value":0,"active-text":"已启用","inactive-text":"已停用","inline-prompt":!0,style:K.value,onChange:()=>I(e)},null)}},{label:"备注",prop:"remark",minWidth:160},{label:"创建时间",prop:"create_time",minWidth:160,formatter:({create_time:e})=>se(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:210,slot:"operation"}];function I({row:e,index:t}){ne.confirm(`确认要<strong>${e.status===0?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${e.name}</strong>吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{if(!le("edit"))return u("权限不足！",{type:"error"}),!1;b({id:e.id,status:e.status}).then(l=>{l.code==200?(p.value[t]=Object.assign({},p.value[t],{loading:!0}),setTimeout(()=>{p.value[t]=Object.assign({},p.value[t],{loading:!1}),u(`已${e.status===0?"停用":"启用"}${e.name}`,{type:"success"})},300)):u(l.error,{type:"error"})})}).catch(()=>{e.status===0?e.status=1:e.status=0})}function O(e){fe({id:e.id}).then(t=>{t.code==200?(u(`您删除了角色编号为${e.id}的这条数据`,{type:"success"}),c()):u(t.error,{type:"error"})})}function P(e){}function V(e){}function j(e){}function c(){return v(this,null,function*(){s.value=!0;const{data:e}=yield me(ie(h));f.value=e.list,y.total=e.total,y.pageSize=e.pageSize,y.currentPage=e.currentPage,setTimeout(()=>{s.value=!1},500)})}const H=e=>{e&&(e.resetFields(),c())};function W(e="新增",t){return v(this,null,function*(){var l,k,M,_;ue({title:`${e}角色`,props:{formInline:{name:(l=t==null?void 0:t.name)!=null?l:"",remark:(k=t==null?void 0:t.remark)!=null?k:"",status:(M=t==null?void 0:t.status)!=null?M:1},treeMenuData:{treeData:m.value,treeIds:o.value,treeSelected:(_=t==null?void 0:t.menu_ids)!=null?_:[]}},width:"40%",draggable:!0,fullscreen:re(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>oe(ce,{ref:d}),beforeSure:(J,{options:U})=>{const q=d.value.getRef(),S=U.props.formInline,G=d.value.getTreeRef();Reflect.set(S,"menu_ids",G.getCheckedKeys()),e=="修改"&&Reflect.set(S,"id",t.id);function Q(){u(`您${e}了角色名称为${S.name}的这条数据`,{type:"success"}),J(),c()}q.validate(Z=>{Z&&b(S).then(T=>{T.code==200?Q():u(T.error,{type:"error"})})})}})})}function Y(e){return v(this,null,function*(){const{id:t,menu_ids:l}=e;t?(n.value=e,r.value=!0,setTimeout(()=>{i.value.setCheckedKeys(JSON.parse(JSON.stringify(l)))},50)):(n.value=null,r.value=!1)})}function A({row:{id:e}}){var t;return{cursor:"pointer",background:e===((t=n.value)==null?void 0:t.id)?"var(--el-fill-color-light)":""}}function B(){const{id:e,name:t}=n.value;b({id:e,menu_ids:i.value.getCheckedKeys()}).then(l=>{u(`角色名称为${t}的菜单权限修改成功`,{type:"success"}),c()})}const E=e=>{i.value.filter(e)},N=(e,t)=>R(t.title).includes(e);return X(()=>v(this,null,function*(){c();const{data:e}=yield ge({page_type:0});o.value=w(e.list,"id"),m.value=ee(e.list)})),x(C,e=>{e?i.value.setExpandedKeys(o.value):i.value.setExpandedKeys([])}),x(D,e=>{e?i.value.setCheckedKeys(o.value):i.value.setCheckedKeys([])}),{form:h,isShow:r,curRow:n,loading:s,columns:F,rowStyle:A,dataList:f,treeData:m,treeProps:L,pagination:y,isExpandAll:C,isSelectAll:D,isLinkage:z,treeSearchValue:g,onSearch:c,resetForm:H,openDialog:W,handleMenu:Y,handleSave:B,handleDelete:O,filterMethod:N,transformI18n:R,onQueryChanged:E,handleSizeChange:P,handleCurrentChange:V,handleSelectionChange:j}}export{Ce as useRole};
