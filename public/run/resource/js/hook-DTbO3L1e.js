var g=(l,c,i)=>new Promise((d,f)=>{var o=s=>{try{u(i.next(s))}catch(n){f(n)}},r=s=>{try{u(i.throw(s))}catch(n){f(n)}},u=s=>s.done?d(s.value):Promise.resolve(s.value).then(o,r);u((i=i.apply(l,c)).next())});import{a2 as I,n as m,q as W,b as T,r as x,aO as z,P as H,aV as P,aW as V,K as q,R as K,aj as N,aD as p}from"./index-BA19eJmX.js";import{_ as A}from"./form.vue_vue_type_script_setup_true_lang-BZJPmGOO.js";import{g as B,d as G,a as J}from"./department-0itGloVX.js";import{u as L}from"./publicStyle-21uR1UcM.js";import{g as Q}from"./staff-CNd9j2Aq.js";import"./index-_Lri3Guu.js";function ae(){const l=I({name:"",status:null}),c=m(),i=m([]),d=m([]),f=m(!0),{tagStyle:o}=L(),r=[{label:"部门名称",prop:"name",width:180,align:"left"},{label:"排序",prop:"sort",minWidth:70},{label:"状态",prop:"status",minWidth:100,cellRenderer:({row:t,props:e})=>T(x("el-tag"),{size:e.size,style:o.value(t.status)},{default:()=>[t.status===1?"启用":"停用"]})},{label:"创建时间",minWidth:200,prop:"create_time",formatter:({create_time:t})=>t?z(t).format("YYYY-MM-DD HH:mm:ss"):""},{label:"备注",prop:"remark",minWidth:320},{label:"操作",fixed:"right",width:210,slot:"operation"}];W(()=>g(this,null,function*(){var e;const{data:t}=yield Q();d.value=(e=t.list)!=null?e:[]}));function u(t){}function s(t){t&&(t.resetFields(),n())}function n(){return g(this,null,function*(){f.value=!0;const{data:t}=yield B({page_type:0});let e=t.list;H(l.name)||(e=e.filter(a=>a.name.includes(l.name))),H(l.status)||(e=e.filter(a=>a.status===l.status)),i.value=P(e,"id","pid"),setTimeout(()=>{f.value=!1},500)})}function v(t){if(!t||!t.length)return;const e=[];for(let a=0;a<t.length;a++)t[a].disabled=t[a].status===0,v(t[a].children),e.push(t[a]);return e}function M(t="新增",e){var a,D,b,y,R,_,k;V({title:`${t}部门`,props:{formInline:{higherDeptOptions:v(q(i.value)),pid:(a=e==null?void 0:e.pid)!=null?a:0,name:(D=e==null?void 0:e.name)!=null?D:"",staff_id:(e==null?void 0:e.staff_id)!=0?e==null?void 0:e.staff_id:null,phone:(b=e==null?void 0:e.phone)!=null?b:"",email:(y=e==null?void 0:e.email)!=null?y:"",sort:(R=e==null?void 0:e.sort)!=null?R:0,status:(_=e==null?void 0:e.status)!=null?_:1,remark:(k=e==null?void 0:e.remark)!=null?k:"",staffList:d.value}},width:"40%",draggable:!0,fullscreen:K(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>N(A,{ref:c}),beforeSure:(Y,{options:$})=>{const j=c.value.getRef(),h=$.props.formInline;t=="修改"&&Reflect.set(h,"id",e.id);function C(){p(`您${t}了部门名称为${h.name}的这条数据`,{type:"success"}),Y(),n()}j.validate(F=>{F&&G(h).then(S=>{S.code==200?C():p(S.error,{type:"error"})})})}})}function O(t){J({id:t.id}).then(e=>{e.code==200?(p(`您删除了部门名称为${t.name}的这条数据`,{type:"success"}),n()):p(e.error,{type:"error"})})}return W(()=>{n()}),{form:l,loading:f,columns:r,dataList:i,onSearch:n,resetForm:s,openDialog:M,handleDelete:O,handleSelectionChange:u}}export{ae as useDept};
