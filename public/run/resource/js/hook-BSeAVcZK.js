var b=(t,f,s)=>new Promise((c,d)=>{var h=a=>{try{p(s.next(a))}catch(u){d(u)}},g=a=>{try{p(s.throw(a))}catch(u){d(u)}},p=a=>a.done?c(a.value):Promise.resolve(a.value).then(h,g);p((s=s.apply(t,f)).next())});import{aM as i,aN as o,n,q as F,aO as x,aP as M,aQ as Y,aD as r,aR as z}from"./index-BgaAjVjm.js";const q=t=>i.request("get",o("admin/db/list"),{params:t}),U=t=>i.request("post",o("admin/db/backup"),{data:t}),j=t=>i.request("post",o("admin/db/optimize"),{data:t}),L=t=>i.request("post",o("admin/db/repair"),{data:t}),A=t=>i.request("get",o("admin/db/file_list"),{params:t}),H=t=>i.request("post",o("admin/db/file_del"),{data:t}),N=t=>i.request("get",o("admin/db/file_downlaod"),{params:t},{responseType:"blob"}),O=t=>i.request("post",o("admin/db/file_import"),{data:t});function Q(t){const f=n([]),s=n(!0),c=n(0),d=n([]),h=n(!1),g=n(),p=n([]),a=[{type:"selection",align:"left"},{label:"表名",prop:"name",width:120,align:"left"},{label:"存储引擎",prop:"engine",width:90},{label:"行格式",prop:"row_format",width:90},{label:"数据长度",prop:"data_length",width:90},{label:"索引长度",prop:"index_length",width:90},{label:"未用空间量",prop:"data_free",width:100},{label:"行数",prop:"rows",width:80},{label:"自增值",prop:"auto_increment",width:80},{label:"字符集",prop:"collation",width:180},{label:"注释",prop:"comment",width:200},{label:"创建时间",width:200,prop:"create_time"},{label:"更新时间",width:200,prop:"update_time"},{label:"操作",fixed:"right",minWidth:50,slot:"operation"}],u=[{label:"字段名",prop:"field",width:120,align:"left"},{label:"类型",prop:"type",width:90},{label:"默认值",prop:"default",width:90},{label:"可否为空",prop:"null",width:90},{label:"字符集",prop:"collation",width:130},{label:"额外信息",prop:"extra",width:130},{label:"索引信息",prop:"key",width:90},{label:"注释",prop:"comment",minWidth:120}],S=[{label:"名称",prop:"name",fixed:"left",align:"left",width:200},{label:"大小",prop:"size",minWidth:90},{label:"compress",prop:"compress",minWidth:90},{label:"part",prop:"part",minWidth:90},{label:"备份时间",prop:"time",minWidth:90,formatter:({time:e})=>e?x(x.unix(e)).format("YYYY-MM-DD HH:mm:ss"):""},{label:"操作",fixed:"right",minWidth:50,slot:"operation"}];function D(){return b(this,null,function*(){const{data:e}=yield q();f.value=e.list})}function W(e){c.value=e.length,t.value.setAdaptive()}function C(){c.value=0,t.value.getTableRef().clearSelection()}function R(e,l){const w=t.value.getTableRef().getSelectionRows(),m=n([]);m.value=M(w,"name");const v=m.value.join(",");e===L&&(m.value=Y(w,"name","engine")),e({tables:m.value}).then(_=>{_.code==200?r(`选中的表 ${v} ${l}成功！`,{type:"success"}):r(`选中的表 ${v} ${l}失败！失败原因： ${_.error}`,{type:"error",showClose:!0,customClass:"el"})}),t.value.getTableRef().clearSelection()}function T(e){h.value=!0,g.value=e.name+(e.comment?"（"+e.comment+"）":"")+"详细信息",q({table:e.name}).then(l=>{l.code==200?d.value=l.data.list:r(l.error,{type:"error"})})}function y(){return b(this,null,function*(){const{data:e}=yield A();p.value=e.list})}function I(e){H({time:e.time}).then(l=>b(this,null,function*(){l.code==200?(r("删除成功!",{type:"success"}),y()):r("删除失败! 原因："+l.error,{type:"success"})}))}function $(e){N({time:e.time}).then(({data:l,headers:w})=>{const v=/filename=([^;]*)/.exec(w.get("content-disposition"));z(l,decodeURI(v[1]))})}function k(e){O({time:e.time,part:e.part}).then(l=>{l.code==200?r("导入成功！",{type:"success"}):r(l.error,{type:"error"})})}return F(()=>b(this,null,function*(){D(),y(),s.value=!1})),{loading:s,columns:a,dataList:f,operation:R,selectedNum:c,onSelectionCancel:C,handleSelectionChange:W,setDbBackup:U,setDbOptimize:j,setDbRepair:L,getTableInfo:T,tableInfo:d,infoDrawer:h,infoColumns:u,infoTitle:g,fileColumns:S,fileList:p,handleFileDel:I,handleFileDownload:$,backupList:y,dbList:D,handleFileImport:k}}export{Q as useUser};
